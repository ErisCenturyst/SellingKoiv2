@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model IEnumerable<SellingKoi.Models.Account>

@{
    ViewData["Title"] = "Quản lý Tài khoản";
}

<h2>Quản lý Tài khoản</h2>

<div class="mb-3">
    <input type="text" class="form-control" placeholder="Tìm kiếm tài khoản..." id="searchInput" onkeyup="searchFunction()">
</div>

<table class="table table-striped table-hover" id="accountTable">
    <thead class="thead-dark">
        <tr>
            <th>Tên tài khoản</th>
            <th>Họ tên</th>
            <th>Ngày đăng kí</th>
            <th>Vai trò</th>
            <th>Hành động</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var account in Model.Where(a => a.Role != "ADMIN"))
        {
            <tr>
                <td>@account.Username</td>
                <td>@account.Fullname</td>
                <td>@account.Registration_date.ToString("dd/MM/yyyy")</td>
                <td>
                    @{
                        string roleDisplay = account.Role switch
                        {
                            "Staff" => "Nhân viên",
                            "SaleStaff" => "Nhân viên bán hàng",
                            "Customer" => "Khách hàng",
                            "Manager" => "Quản lý",
                            _ => account.Role
                        };
                    }
                    @roleDisplay
                </td>
                <td>
                    <a asp-action="DetailsAccount" asp-route-id="@account.Id" class="btn btn-warning btn-sm">Chi tiết</a>
                    <form asp-action="NegateAccount" asp-route-id="@account.Id" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Bạn có chắc chắn muốn xóa tài khoản này?');">Xóa</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<script>
    function searchFunction() {
        var input, filter, table, tr, td, i, j, txtValue;
        input = document.getElementById("searchInput");
        filter = input.value.toUpperCase();
        table = document.getElementById("accountTable");
        tr = table.getElementsByTagName("tr");

        for (i = 1; i < tr.length; i++) {
            tr[i].style.display = "none"; // Hide all rows initially
            td = tr[i].getElementsByTagName("td");
            for (j = 0; j < td.length; j++) {
                if (td[j]) {
                    txtValue = td[j].textContent || td[j].innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = ""; // Show the row if it matches
                        break;
                    }
                }
            }
        }
    }
</script>

